---
config:
  layout: elk
---
flowchart TD
    AD[fa:fa-sitemap Active Directory Structure Data]
    LG[fa:fa-user-group Local Groups/NTLM]
    S[fa:fa-user Sessions]
    CS[fa:fa-certificate Certificate Services Data]
    CA[fa:fa-certificate CA Registry Data]
    DC[fa:fa-server DC Registry Data/LDAP Services]

    style AD fill:#16a5a5
    style LG fill:#73d8ff
    style S fill:#d33115,color:#fff
    style CS fill:#fcdc00
    style CA fill:#0062b1,color:#fff
    style DC fill:#942663,color:#fff
    style AbuseTGTDelegation fill:#9C27B0,color:#fff
    style CanRDP fill:#9C27B0,color:#fff
    style HasTrustKeys fill:#9C27B0,color:#fff
    style ADCSESC1 fill:#9C27B0,color:#fff
    style ClaimSpecialIdentity fill:#9C27B0,color:#fff
    style ManageCA fill:#9C27B0,color:#fff
    style ADCSESC10a fill:#9C27B0,color:#fff
    style CoerceAndRelayNTLMToADCS fill:#9C27B0,color:#fff
    style ManageCertificates fill:#9C27B0,color:#fff
    style ADCSESC10b fill:#9C27B0,color:#fff
    style CoerceAndRelayNTLMToLDAP fill:#9C27B0,color:#fff
    style MemberOf fill:#9C27B0,color:#fff
    style ADCSESC13 fill:#9C27B0,color:#fff
    style CoerceAndRelayNTLMToLDAPS fill:#9C27B0,color:#fff
    style Owns fill:#9C27B0,color:#fff
    style ADCSESC3 fill:#9C27B0,color:#fff
    style CoerceAndRelayNTLMToSMB fill:#9C27B0,color:#fff
    style OwnsLimitedRights fill:#9C27B0,color:#fff
    style ADCSESC4 fill:#9C27B0,color:#fff
    style CoerceToTGT fill:#9C27B0,color:#fff
    style ReadGMSAPassword fill:#9C27B0,color:#fff
    style ADCSESC6a fill:#9C27B0,color:#fff
    style Contains fill:#9C27B0,color:#fff
    style ReadLAPSPassword fill:#9C27B0,color:#fff
    style ADCSESC6b fill:#9C27B0,color:#fff
    style DCFor fill:#9C27B0,color:#fff
    style SameForestTrust fill:#9C27B0,color:#fff
    style ADCSESC9a fill:#9C27B0,color:#fff
    style DCSync fill:#9C27B0,color:#fff
    style SpoofSIDHistory fill:#9C27B0,color:#fff
    style ADCSESC9b fill:#9C27B0,color:#fff
    style DumpSMSAPassword fill:#9C27B0,color:#fff
    style SQLAdmin fill:#9C27B0,color:#fff
    style AddAllowedToAct fill:#9C27B0,color:#fff
    style ExecuteDCOM fill:#9C27B0,color:#fff
    style SyncedToEntraUser fill:#9C27B0,color:#fff
    style AddKeyCredentialLink fill:#9C27B0,color:#fff
    style ForceChangePassword fill:#9C27B0,color:#fff
    style SyncLAPSPassword fill:#9C27B0,color:#fff
    style AddMember fill:#9C27B0,color:#fff
    style GPLink fill:#9C27B0,color:#fff
    style WriteAccountRestrictions fill:#9C27B0,color:#fff
    style AddSelf fill:#9C27B0,color:#fff
    style GenericAll fill:#9C27B0,color:#fff
    style WriteDacl fill:#9C27B0,color:#fff
    style AdminTo fill:#9C27B0,color:#fff
    style GenericWrite fill:#9C27B0,color:#fff
    style WriteGPLink fill:#9C27B0,color:#fff
    style AllExtendedRights fill:#9C27B0,color:#fff
    style GoldenCert fill:#9C27B0,color:#fff
    style WriteOwner fill:#9C27B0,color:#fff
    style AllowedToAct fill:#9C27B0,color:#fff
    style HasSIDHistory fill:#9C27B0,color:#fff
    style WriteOwnerLimitedRights fill:#9C27B0,color:#fff
    style AllowedToDelegate fill:#9C27B0,color:#fff
    style HasSession fill:#9C27B0,color:#fff
    style WriteSPN fill:#9C27B0,color:#fff
    style CanPSRemote fill:#9C27B0,color:#fff
    style CrossForestTrust fill:#4CAF50
    style GetChangesInFilteredSet fill:#4CAF50
    style PublishedTo fill:#4CAF50
    style DelegatedEnrollmentAgent fill:#4CAF50
    style HostsCAService fill:#4CAF50
    style RemoteInteractiveLogonRight fill:#4CAF50
    style Enroll fill:#4CAF50
    style IssuedSignedBy fill:#4CAF50
    style RootCAFor fill:#4CAF50
    style EnrollOnBehalfOf fill:#4CAF50
    style LocalToComputer fill:#4CAF50
    style TrustedForNTAuth fill:#4CAF50
    style EnterpriseCAFor fill:#4CAF50
    style MemberOfLocalGroup fill:#4CAF50
    style WriteOwnerRaw fill:#4CAF50
    style ExtendedByPolicy fill:#4CAF50
    style NTAuthStoreFor fill:#4CAF50
    style WritePKIEnrollmentFlag fill:#4CAF50
    style GetChanges fill:#4CAF50
    style OIDGroupLink fill:#4CAF50
    style WritePKINameFlag fill:#4CAF50
    style GetChangesAll fill:#4CAF50
    style OwnsRaw fill:#4CAF50


    AD -->|HasDataFor| AbuseTGTDelegation
    AD -->|HasDataFor| CanRDP
    MemberOfLocalGroup ==>|HasDataFor| CanRDP
    RemoteInteractiveLogonRight ==>|Enables| CanRDP
    AD -->|HasDataFor| HasTrustKeys
    AD -->|HasDataFor| ADCSESC1
    CS -->|HasDataFor| ADCSESC1
    TrustedForNTAuth -->|Enables| ADCSESC1
    %% ClaimSpecialIdentity  // Why is this traversable?
    AD -->|HasDataFor| ManageCA
    CS -->|HasDataFor| ManageCA
    AD -->|HasDataFor| ADCSESC10a
    CS -->|HasDataFor| ADCSESC10a
    DC ==>|HasDataFor| ADCSESC10a
    AD -->|HasDataFor| CoerceAndRelayNTLMToADCS
    CS -->|HasDataFor| CoerceAndRelayNTLMToADCS
    LG ==>|HasDataFor| CoerceAndRelayNTLMToADCS
    CS -->|EnrollmentConfigFor| CoerceAndRelayNTLMToADCS
    AD -->|HasDataFor| ManageCertificates
    CS -->|HasDataFor| ManageCertificates
    AD -->|HasDataFor| ADCSESC10b
    CS -->|HasDataFor| ADCSESC10b
    DC ==>|HasDataFor| ADCSESC10b
    AD -->|HasDataFor| CoerceAndRelayNTLMToLDAP
     %% why not DC?
    LG ==>|HasDataFor| CoerceAndRelayNTLMToLDAP
    AD -->|HasDataFor| MemberOf
    LG ==>|HasDataFor| MemberOf
    AD -->|HasDataFor| ADCSESC13
    CS -->|HasDataFor| ADCSESC13
    AD -->|HasDataFor| CoerceAndRelayNTLMToLDAPS
    LG ==>|HasDataFor| CoerceAndRelayNTLMToLDAPS
    %% ??DC ==>|LDAPConfigFor| CoerceAndRelayNTLMToLDAPS
    AD -->|HasDataFor| Owns
    CS -->|HasDataFor| Owns
    AD -->|HasDataFor| ADCSESC3
    CS -->|HasDataFor| ADCSESC3
    CA -->|HasOptionalDataFor| ADCSESC3
    DelegatedEnrollmentAgent -->|Enables| ADCSESC3
    AD -->|HasDataFor| CoerceAndRelayNTLMToSMB
    LG ==>|SMBConfigFor| CoerceAndRelayNTLMToSMB
    AD -->|HasDataFor| OwnsLimitedRights
    CS -->|HasDataFor| OwnsLimitedRights
    AD -->|HasDataFor| ADCSESC4
    CS -->|HasDataFor| ADCSESC4
    AD -->|HasDataFor| CoerceToTGT
    AD -->|HasDataFor| ReadGMSAPassword
    AD -->|HasDataFor| ADCSESC6a
    CS -->|HasDataFor| ADCSESC6a
    CA -->|HasDataFor| ADCSESC6a
    AD -->|HasDataFor| Contains
    AD -->|HasDataFor| ReadLAPSPassword
    AD -->|HasDataFor| ADCSESC6b
    CS -->|HasDataFor| ADCSESC6b
    CA -->|HasDataFor| ADCSESC6b
    DC ==>|HasDataFor| ADCSESC6b
    AD -->|HasDataFor| DCFor
    AD -->|HasDataFor| SameForestTrust
    AD -->|HasDataFor| ADCSESC9a
    CS -->|HasDataFor| ADCSESC9a
    DC ==>|HasDataFor| ADCSESC9a
    AD -->|HasDataFor| DCSync
    AD -->|HasDataFor| SpoofSIDHistory
    AD -->|HasDataFor| ADCSESC9b
    CS -->|HasDataFor| ADCSESC9b
    DC ==>|HasDataFor| ADCSESC9b
    AD -->|HasDataFor| DumpSMSAPassword
    AD -->|HasDataFor| SQLAdmin
    AD -->|HasDataFor| AddAllowedToAct
    AD -->|HasDataFor| ExecuteDCOM
    LG ==>|HasDataFor| ExecuteDCOM
    AD -->|HasDataFor| SyncedToEntraUser
    AZ -->|HasDataFor| SyncedToEntraUser
    AD -->|HasDataFor| AddKeyCredentialLink
    AD -->|HasDataFor| ForceChangePassword
    AD -->|HasDataFor| SyncLAPSPassword
    AD -->|HasDataFor| AddMember
    AD -->|HasDataFor| GPLink
    AD -->|HasDataFor| WriteAccountRestrictions
    AD -->|HasDataFor| AddSelf
    AD -->|HasDataFor| GenericAll
    CS -->|HasDataFor| GenericAll
    AD -->|HasDataFor| WriteDacl
    AD -->|HasDataFor| WriteDacl
    AD -->|HasDataFor| AdminTo
    LG ==>|HasDataFor| AdminTo
    AD -->|HasDataFor| GenericWrite
    AD -->|HasDataFor| WriteGPLink
    AD -->|HasDataFor| AllExtendedRights
    CS -->|HasDataFor| AllExtendedRights
    AD -->|HasDataFor| GoldenCert
    CS -->|HasDataFor| GoldenCert
    AD -->|HasDataFor| WriteOwner
    CS -->|HasDataFor| WriteOwner
    AD -->|HasDataFor| AllowedToAct
    AD -->|HasDataFor| HasSIDHistory
    AD -->|HasDataFor| WriteOwnerLimitedRights
    CS -->|HasDataFor| WriteOwnerLimitedRights
    AD -->|HasDataFor| AllowedToDelegate
    S  ==>|HasDataFor| HasSession
    AD -->|HasDataFor| WriteSPN
    AD -->|HasDataFor| CanPSRemote
    LG ==>|HasDataFor| CanPSRemote
    AD -->|HasDataFor| CrossForestTrust
    AD -->|HasDataFor| GetChangesInFilteredSet
    CS -->|HasDataFor| PublishedTo
    AD -->|HasDataFor| DelegatedEnrollmentAgent
    CS -->|HasDataFor| DelegatedEnrollmentAgent
    CA -->|HasDataFor| DelegatedEnrollmentAgent
    AD -->|HasDataFor| HostsCAService
    CS -->|HasDataFor| HostsCAService
    LG ==>|HasDataFor| RemoteInteractiveLogonRight
    AD -->|HasDataFor| Enroll
    CS -->|HasDataFor| Enroll
    CS -->|HasDataFor| IssuedSignedBy
    CS -->|HasDataFor| RootCAFor
    CS -->|HasDataFor| EnrollOnBehalfOf
    LG ==>|HasDataFor| LocalToComputer
    CS -->|HasDataFor| TrustedForNTAuth
    CS -->|HasDataFor| EnterpriseCAFor
    LG ==>|HasDataFor| MemberOfLocalGroup
    AD -->|HasDataFor| WriteOwnerRaw
    CS -->|HasDataFor| WriteOwnerRaw
    CS -->|HasDataFor| ExtendedByPolicy
    CS -->|HasDataFor| NTAuthStoreFor
    AD -->|HasDataFor| WritePKIEnrollmentFlag
    CS -->|HasDataFor| WritePKIEnrollmentFlag
    AD -->|HasDataFor| GetChanges
    CS -->|HasDataFor| OIDGroupLink
    AD -->|HasDataFor| WritePKINameFlag
    CS -->|HasDataFor| WritePKINameFlag
    AD -->|HasDataFor| GetChangesAll
    AD -->|HasDataFor| OwnsRaw
    CS -->|HasDataFor| OwnsRaw

    linkStyle 3 priv stroke:red,stroke-width:4px